<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Post</title>
</head>

<body>
    <h2>Create a Post</h2>

    <!-- Input để chọn file ảnh -->
    <input type="file" id="fileInput" accept="image/*" />
    <!-- Input để nhập nội dung bài viết -->
    <input type="text" id="postContent" placeholder="Enter your post content" />
    <!-- Nút để tạo bài viết -->
    <button onclick="createPost()">Create Post</button>

    <script>
        const createPost = () => {
            const content = document.getElementById("postContent").value.trim();
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];
            const type = "IMAGE";

            if (!content || !file) {
                alert("Please enter content and choose an image!");
                return;
            }

            // Kiểm tra file là hình ảnh
            if (!file.type.startsWith("image/")) {
                alert("Please select a valid image file!");
                return;
            }

            const postData = {
                content,
                status: "PUBLIC",
                user_id: 1,
                location_id: 1,
            };

            const formData = new FormData();
            formData.append("post", JSON.stringify(postData)); // JSON của bài viết
            formData.append("files", file); // Hình ảnh
            formData.append("type", type); // Loại

            fetch("http://localhost:8080/api/posts", {
                method: "POST",
                headers: {
                    Authorization: "Bearer eyJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJxdXluaGxtLmRldkBnbWFpbC5jb20iLCJzdWIiOiJhZG1pbiIsImV4cCI6MTczMTcyOTc5MywiaWF0IjoxNzMxNzI2MTkzLCJzY29wZSI6IkFETUlOIn0.Y_PMFZtkOqKT2qN6DNuOhN6-Wj_vAOsL3lnYgqiuD_Y5g1MX1evagA3OjO36zi4ZvlXiKnn6ZJIGKKT11TywRw",
                },
                body: formData,
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to create post");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Post created successfully:", data);
                    alert(data.message);
                })
                .catch(error => {
                    console.error("Error creating post:", error);
                    alert("Error creating post");
                });

        };

    </script>
</body>

</html>
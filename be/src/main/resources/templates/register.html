<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Required Meta Tags Always Come First -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Title -->
  <title>Basic Sign Up | Front - Admin &amp; Dashboard Template</title>

  <link rel="stylesheet" th:href="@{/assets/css/vendor.min.css}">
  <link rel="stylesheet" th:href="@{/assets/vendor/icon-set/style.css}">
  <link rel="stylesheet" th:href="@{/assets/css/theme.min.css?v=1.0}">
</head>

<body>
  <main id="content" role="main" class="main">
    <div class="position-fixed top-0 right-0 left-0 bg-img-hero"
      style="height: 32rem; background-image: url(/assets/svg/components/abstract-bg-4.svg);">
      <figure class="position-absolute right-0 bottom-0 left-0">
        <svg preserveaspectratio="none" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 1921 273">
          <polygon fill="#fff" points="0,273 1921,273 1921,0 "></polygon>
        </svg>
      </figure>
    </div>

    <div class="container py-5 py-sm-7">
      <a class="d-flex justify-content-center mb-5" >
        <img class="z-index-2" th:src="@{/assets/svg/logos/logo.svg}" alt="Image Description" style="width: 8rem;">
      </a>

      <div class="row justify-content-center">
        <div class="col-md-7 col-lg-5">
          <div class="card card-lg mb-5">
            <div class="card-body">
              <form class="js-validate" novalidate="novalidate">
                <div class="text-center">
                  <div class="mb-5">
                    <h1 class="display-4">Create your account</h1>
                    <p>Already have an account? <a th:href="@{/web-server/login}">Sign in here</a></p>
                  </div>
                </div>
                <label class="input-label" for="fullNameSrEmail">Full name</label>

                <div class="form-row">
                  <div class="col-sm-12">
                    <div class="js-form-message form-group">
                      <input type="text" class="form-control form-control-lg" placeholder="Your Fullname" required=""
                        id="fullName" data-msg="Please enter your full name.">
                    </div>
                  </div>
                </div>

                <div class="js-form-message form-group">
                  <label class="input-label" for="signupSrEmail">Your email</label>

                  <input type="email" class="form-control form-control-lg" name="email" id="signupSrEmail"
                    placeholder="Markwilliams@example.com" aria-label="Markwilliams@example.com" required=""
                    data-msg="Please enter a valid email address." data-msg-exists="This email is already registered.">
                </div>

                <div class="js-form-message form-group">
                  <label class="input-label" for="signupSrPassword">Password</label>

                  <div class="input-group input-group-merge">
                    <input type="password" class="js-toggle-password form-control form-control-lg" name="password"
                      id="signupSrPassword" placeholder="8+ characters required" aria-label="8+ characters required"
                      required="" data-msg="Your password is invalid. Please try again."
                      data-hs-toggle-password-options='{
                               "target": [".js-toggle-password-target-1", ".js-toggle-password-target-2"],
                               "defaultClass": "tio-hidden-outlined",
                               "showClass": "tio-visible-outlined",
                               "classChangeTarget": ".js-toggle-passowrd-show-icon-1"
                             }'>
                    <div class="js-toggle-password-target-1 input-group-append">
                      <a class="input-group-text" href="javascript:;">
                        <i class="js-toggle-passowrd-show-icon-1 tio-visible-outlined"></i>
                      </a>
                    </div>
                  </div>
                </div>

                <div class="js-form-message form-group">
                  <label class="input-label" for="signupSrConfirmPassword">Confirm password</label>

                  <div class="input-group input-group-merge">
                    <input type="password" class="js-toggle-password form-control form-control-lg"
                      name="confirmPassword" id="signupSrConfirmPassword" placeholder="8+ characters required"
                      aria-label="8+ characters required" required=""
                      data-msg="Password does not match the confirm password." data-hs-toggle-password-options='{
                               "target": [".js-toggle-password-target-1", ".js-toggle-password-target-2"],
                               "defaultClass": "tio-hidden-outlined",
                               "showClass": "tio-visible-outlined",
                               "classChangeTarget": ".js-toggle-passowrd-show-icon-2"
                             }'>
                    <div class="js-toggle-password-target-2 input-group-append">
                      <a class="input-group-text" href="javascript:;">
                        <i class="js-toggle-passowrd-show-icon-2 tio-visible-outlined"></i>
                      </a>
                    </div>
                  </div>
                </div>

                <div class="js-form-message form-group">
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="termsCheckbox" name="termsCheckbox"
                      required="" data-msg="Please accept our Terms and Conditions.">
                    <label class="custom-control-label text-muted" for="termsCheckbox"> I accept the <a href="#">Terms
                        and Conditions</a></label>
                  </div>
                </div>

                <button type="submit" class="btn btn-lg btn-block btn-primary mb-2" id="submit">Create an
                  account</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>


  <script th:src="@{/assets/js/vendor.min.js}"></script>
  <script th:src="@{/assets/js/theme.min.js}"></script>

  <script>
    $(document).on('ready', function () {
      $('.js-toggle-password').each(function () {
        new HSTogglePassword(this).init()
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const fullName = document.getElementById('fullName');
      const email = document.getElementById('signupSrEmail');
      const password = document.getElementById('signupSrPassword');
      const confirmPassword = document.getElementById('signupSrConfirmPassword');
      const save = document.getElementById('submit');

      // Khởi tạo kiểm tra form với jQuery
      $('.js-validate').each(function () {
        $.HSCore.components.HSValidation.init($(this), {
          rules: {
            confirmPassword: {
              equalTo: '#signupSrPassword' // Xác nhận mật khẩu phải khớp
            }
          },
        });
      });

      // Hàm xử lý đăng ký
      const registerUser = async () => {
        try {
          const formData = {
            fullname: fullName.value.trim(),
            email: email.value.trim(),
            password: password.value.trim()
          };

          // Hiển thị trạng thái "Loading"
          save.disabled = true;
          save.textContent = 'Registering...';

          // Gửi yêu cầu tới API
          const response = await fetch('http://localhost:8080/onboarding/createManager', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();

          // Xử lý kết quả
          if (data.status) {
            alert('User registered successfully!');
            window.location.href = '/web-server/login';
          } else {
            throw new Error(data.error?.message || data.errors?.[0]?.message);
          }
        } catch (error) {
          console.error('Error:', error.message);
          alert(error.message);
        } finally {
          // Reset trạng thái nút
          save.disabled = false;
          save.textContent = 'Create an account';
        }
      };

      // Lắng nghe sự kiện click
      save.addEventListener('click', (e) => {
        e.preventDefault(); // Ngăn chặn form submit mặc định

        // Kiểm tra form với jQuery
        const isValid = $('.js-validate').valid(); // Phương thức `.valid()` của jQuery Validation
        if (isValid) {
          registerUser(); // Nếu form hợp lệ, gọi hàm đăng ký
        } else {
          alert('Please check your input and try again.');
        }
      });
    });
  </script>

  <script>
    if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) document.write('<script src="/assets/vendor/babel-polyfill/polyfill.min.js"><\/script>');
  </script>
</body>
</html>

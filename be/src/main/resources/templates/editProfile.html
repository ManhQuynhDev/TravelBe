<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Home</title>
    <link rel="stylesheet" th:href="@{/assets/css/vendor.min.css}">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/assets/vendor/icon-set/style.css}">
    <link rel="stylesheet" th:href="@{/assets/css/theme.min.css?v=1.0}">

</head>

<body>
    <div th:replace="fragments/buildertoggle"></div>
    <div th:replace="fragments/headerMain"></div>
    <div id="headerFluid" class="d-none">
        <header id="header"
            class="navbar navbar-expand-xl navbar-fixed navbar-height navbar-flush navbar-container navbar-bordered  ">
            <div class="js-mega-menu navbar-nav-wrap">
                <div class="navbar-brand-wrapper">
                    <a class="navbar-brand" th:href="@{/}" aria-label="Front">
                        <img class="navbar-brand-logo" th:src="@{/assets/svg/logos/logo.svg}" alt="Logo">
                    </a>
                </div>
            </div>
        </header>
    </div>
    <div id="headerDouble" class="d-none">
        <header id="header" class="navbar navbar-expand-lg navbar-bordered flex-lg-column px-0">
        </header>
    </div>
    <div th:replace="fragments/sidebarMain"></div>
    <div id="sidebarCompact" class="d-none">
        <aside
            class="js-navbar-vertical-aside navbar navbar-vertical-aside navbar-vertical navbar-vertical-fixed navbar-expand-xl navbar-bordered  ">
            <div class="navbar-vertical-container">
                <div class="navbar-vertical-content">
                </div>
            </div>
        </aside>
    </div>

    <div th:replace="fragments/searchDropdown"></div>
    <div id="content" role="main" class="main pointer-event">
        <div class="content container-fluid">
            <!-- Page Header -->
            <div class="page-header">
                <div class="row align-items-end">
                    <div class="col-sm mb-2 mb-sm-0">

                        <h1 class="page-header-title">Settings</h1>
                    </div>

                    <div class="col-sm-auto">
                        <a class="btn btn-primary" th:href="@{/web-server/profile}">
                            <i class="tio-user mr-1"></i> My profile
                        </a>
                    </div>

                </div>
                <!-- End Row -->
            </div>
            <!-- End Page Header -->

            <div class="row">
                <div class="col-lg-3">
                    <!-- Navbar -->
                    <div class="navbar-vertical navbar-expand-lg mb-3 mb-lg-5">
                        <!-- Navbar Toggle -->
                        <button type="button" class="navbar-toggler btn btn-block btn-white mb-3"
                            aria-label="Toggle navigation" aria-expanded="false" aria-controls="navbarVerticalNavMenu"
                            data-toggle="collapse" data-target="#navbarVerticalNavMenu">
                            <span class="d-flex justify-content-between align-items-center">
                                <span class="h5 mb-0">Nav menu</span>

                                <span class="navbar-toggle-default">
                                    <i class="tio-menu-hamburger"></i>
                                </span>

                                <span class="navbar-toggle-toggled">
                                    <i class="tio-clear"></i>
                                </span>
                            </span>
                        </button>
                        <!-- End Navbar Toggle -->

                        <div id="navbarVerticalNavMenu" class="collapse navbar-collapse">
                            <!-- Navbar Nav -->
                            <ul id="navbarSettings"
                                class="js-sticky-block js-scrollspy navbar-nav navbar-nav-lg nav-tabs card card-navbar-nav"
                                data-hs-sticky-block-options='{
                           "parentSelector": "#navbarVerticalNavMenu",
                           "breakpoint": "lg",
                           "startPoint": "#navbarVerticalNavMenu",
                           "endPoint": "#stickyBlockEndPoint",
                           "stickyOffsetTop": 20
                         }'>
                                <li class="nav-item">
                                    <a class="nav-link active" href="#contents">
                                        <i class="tio-user-outlined nav-icon"></i> Basic information
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#passwordSection">
                                        <i class="tio-lock-outlined nav-icon"></i> Password
                                    </a>
                                </li>
                            </ul>
                            <!-- End Navbar Nav -->
                        </div>
                    </div>
                    <!-- End Navbar -->
                </div>

                <div class="col-lg-9">
                    <div class="mb-3 mb-lg-5" id="contents">
                        <div class="card">
                            <div class="profile-cover">
                                <div class="profile-cover-img-wrapper">
                                    <img id="profileCoverImg" class="profile-cover-img"
                                        src="/assets/img/1920x400/img2.jpg" alt="Image Description">
                                    <div class="profile-cover-content profile-cover-btn">
                                        <div class="custom-file-btn">

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <label
                                class="avatar avatar-xxl avatar-circle avatar-border-lg avatar-uploader profile-cover-avatar"
                                for="avatarUploader">
                                <img id="profileImg" class="avatar-img" src="assets\img\160x160\img6.jpg"
                                    alt="Image Description">

                                <input type="file" class="js-file-attach avatar-uploader-input" id="avatarUploader"
                                    data-hs-file-attach-options='{
                                        "textTarget": "#profileImg",
                                        "mode": "image",
                                        "targetAttr": "src",
                                        "allowTypes": [".png", ".jpeg", ".jpg"]
                                    }'>

                                <span class="avatar-uploader-trigger">
                                    <i class="tio-edit avatar-uploader-icon shadow-soft"></i>
                                </span>
                            </label>

                            <div class="card-header">
                                <h2 class="card-title h4">Basic information</h2>
                            </div>

                            <div class="card-body">
                                <form id="userForm">
                                    <div class="row form-group">
                                        <label for="fullNameInput" class="col-sm-3 col-form-label input-label">Full
                                            Name</label>
                                        <div class="col-sm-9">
                                            <div class="input-group input-group-sm-down-break">
                                                <input type="text" class="form-control" id="fullNameInput"
                                                    placeholder="Your Full Name">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <label for="emailInput"
                                            class="col-sm-3 col-form-label input-label">Email</label>
                                        <div class="col-sm-9">
                                            <input type="email" class="form-control" id="emailInput" placeholder="Email"
                                                readonly>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <label for="phoneInput"
                                            class="col-sm-3 col-form-label input-label">Phone</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" id="phoneInput"
                                                placeholder="+x(xxx)xxx-xx-xx">
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <label for="dobInput" class="col-sm-3 col-form-label input-label">Date of
                                            Birth</label>
                                        <div class="col-sm-9">
                                            <input type="date" class="form-control" id="dobInput">
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <label for="bioInput" class="col-sm-3 col-form-label input-label">Bio</label>
                                        <div class="col-sm-9">
                                            <textarea class="form-control" id="bioInput" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                    </div>
                                </form>


                            </div>
                        </div>
                    </div>
                    <div id="passwordSection" class="card mb-3 mb-lg-5">
                        <div class="card-header">
                            <h4 class="card-title">Change your password</h4>
                        </div>

                        <!-- Body -->
                        <div class="card-body">
                            <!-- Form -->
                            <form id="changePasswordForm">
                                <!-- Form Group -->
                                <div class="row form-group">
                                    <label for="currentPasswordLabel"
                                        class="col-sm-3 col-form-label input-label">Current password</label>

                                    <div class="col-sm-9">
                                        <input type="password" class="form-control" name="currentPassword"
                                            id="currentPasswordLabel" placeholder="Enter current password"
                                            aria-label="Enter current password">
                                    </div>
                                </div>
                                <!-- End Form Group -->

                                <!-- Form Group -->
                                <div class="row form-group">
                                    <label for="newPassword" class="col-sm-3 col-form-label input-label">New
                                        password</label>

                                    <div class="col-sm-9">
                                        <input type="password" class="js-pwstrength form-control" name="newPassword"
                                            id="newPassword" placeholder="Enter new password"
                                            aria-label="Enter new password" data-hs-pwstrength-options='{
                                   "ui": {
                                     "container": "#changePasswordForm",
                                     "viewports": {
                                       "progress": "#passwordStrengthProgress",
                                       "verdict": "#passwordStrengthVerdict"
                                     }
                                   }
                                 }'>

                                        <p id="passwordStrengthVerdict" class="form-text mb-2">

                                        <div id="passwordStrengthProgress"></div>
                                    </div>
                                </div>
                                <!-- End Form Group -->

                                <!-- Form Group -->
                                <div class="row form-group">
                                    <label for="confirmNewPasswordLabel"
                                        class="col-sm-3 col-form-label input-label">Confirm new password</label>

                                    <div class="col-sm-9">
                                        <div class="mb-3">
                                            <input type="password" class="form-control" name="confirmNewPassword"
                                                id="confirmNewPasswordLabel" placeholder="Confirm your new password"
                                                aria-label="Confirm your new password">
                                        </div>

                                        <h5>Password requirements:</h5>

                                        <p class="font-size-sm mb-2">Ensure that these requirements are met:</p>

                                        <ul class="font-size-sm">
                                            <li>Minimum 8 characters long - the more, the better</li>
                                            <li>At least one lowercase character</li>
                                            <li>At least one uppercase character</li>
                                            <li>At least one number, symbol, or whitespace character</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- End Form Group -->

                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                            <!-- End Form -->
                        </div>
                        <!-- End Body -->
                    </div>
                    <div id="stickyBlockEndPoint"></div>
                </div>
            </div>
            <!-- End Row -->
        </div>
        <!-- End Content -->

        <!-- Footer -->


    </div>
    <script th:src="@{/assets/js/demo.js}"></script>
    <script th:src="@{/assets/js/vendor.min.js}"></script>
    <script th:src="@{/assets/js/theme.min.js}"></script>
    <script th:src="@{/assets/js/userjs.js}"></script>
    <script>
        $(document).on('ready', function () {
            $('.js-navbar-vertical-aside-toggle-invoker').click(function () {
                $('.js-navbar-vertical-aside-toggle-invoker i').tooltip('hide');
            });
            var megaMenu = new HSMegaMenu($('.js-mega-menu'), {
                desktop: {
                    position: 'left'
                }
            }).init();
            var sidebar = $('.js-navbar-vertical-aside').hsSideNav();
            $('.js-nav-tooltip-link').tooltip({ boundary: 'window' });
            $(".js-nav-tooltip-link").on("show.bs.tooltip", function (e) {
                if (!$("body").hasClass("navbar-vertical-aside-mini-mode")) {
                    return false;
                }
            });
        });
        $('.js-hs-unfold-invoker').each(function () {
            var unfold = new HSUnfold($(this)).init();
        });

        document.getElementById("logoutLink").addEventListener("click", function () {
            window.location.replace("/web-server/login");
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hs-sticky-block@1.0.0/dist/hs-sticky-block.min.js"></script>
    <script>
        $(document).on('ready', function () {
            $('.js-sticky-block').each(function () {
                var stickyBlock = new HSStickyBlock($(this), {
                    targetSelector: $('#header').hasClass('navbar-fixed') ? '#header' : null
                }).init();
            });
            var scrollspy = new HSScrollspy($('body'), {
                beforeScroll: function (resolve) {
                    if (window.innerWidth < 992) {
                        $('#navbarVerticalNavMenu').collapse('hide').on('hidden.bs.collapse', function () {
                            return resolve('completed');
                        });
                    } else {
                        return resolve('completed');
                    }
                }
            }).init();
            $('.js-pwstrength').each(function () {
                var pwstrength = $.HSCore.components.HSPWStrength.init($(this));
            });
            // Hàm lấy dữ liệu người dùng từ API bằng ID
            function loadUserData(userId) {
                fetch(`http://localhost:8080/onboarding/users/${userId}`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
                }) // Thay URL bằng endpoint của bạn
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Network response was not ok " + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Gán dữ liệu vào form
                        console.log("API Response:", data);
                        document.getElementById("fullNameInput").value = data.data.fullname || "";
                        document.getElementById("emailInput").value = data.data.email || "";
                        document.getElementById("phoneInput").value = data.data.phoneNumber || "";
                        document.getElementById("dobInput").value = data.data.dob ? data.data.dob.split('T')[0] : "";
                        document.getElementById("bioInput").value = data.data.bio || "";
                        const profileImg = document.getElementById("profileImg");

                        if (data.data.avatarUrl) {
                            profileImg.src = data.data.avatarUrl;  // Nếu có ảnh, sử dụng ảnh từ API
                        } else {
                            // Nếu không có ảnh, lấy chữ cái đầu tiên của tên
                            const firstLetter = data.data.fullname ? data.data.fullname.charAt(0).toUpperCase() : '';
                            profileImg.src = `https://via.placeholder.com/150/808080/000000?text=${firstLetter}`; // Ảnh mặc định với chữ cái đầu tiên
                        }
                    })
                    .catch(error => {
                        console.error("There was a problem fetching user data:", error);
                    });
            }

            // Gọi hàm để load dữ liệu với ID người dùng cụ thể
            const userId = localStorage.getItem("user_id"); // Ví dụ ID người dùng
            loadUserData(userId);
        });


    </script>
    <script th:src="@{/assets/js/userjs.js}"></script>
    <script>
        if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) document.write('<script src="./assets/vendor/babel-polyfill/polyfill.min.js"><\/script>');
    </script>

</body>

</html>
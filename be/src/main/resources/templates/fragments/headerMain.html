<div id="headerMain" class="d-none" th:fragment="headerMain">
  <header id="header"
    class="navbar navbar-expand-lg navbar-fixed navbar-height navbar-flush navbar-container navbar-bordered">
    <div class="navbar-nav-wrap">
      <div class="navbar-brand-wrapper">
        <a class="navbar-brand" th:href="@{/web-server/}" aria-label="Front">
          <img class="navbar-brand-logo" th:src="@{/assets/svg/logos/logo.svg}" alt="Logo">
          <img class="navbar-brand-logo-mini" th:src="@{/assets/svg/logos/logo.svg}" alt="Logo">
        </a>
      </div>
      <div class="navbar-nav-wrap-content-left">
        <!-- Navbar Vertical Toggle -->
        <button type="button" class="js-navbar-vertical-aside-toggle-invoker close mr-3" id="toggleNavbar">
          <i class="tio-first-page navbar-vertical-aside-toggle-short-align" data-toggle="tooltip"
            data-placement="right" title="" data-original-title="Collapse"></i>
          <i class="tio-last-page navbar-vertical-aside-toggle-full-align"
            data-template="<div class=&quot;tooltip d-none d-sm-block&quot; role=&quot;tooltip&quot;><div class=&quot;arrow&quot;></div><div class=&quot;tooltip-inner&quot;></div></div>"
            data-toggle="tooltip" data-placement="right" title="" data-original-title="Expand"></i>
        </button>
      </div>

      <div class="navbar-nav-wrap-content-right">
        <ul class="navbar-nav align-items-center flex-row">
          <li class="nav-item d-md-none">
            <div class="hs-unfold">
              <a class="js-hs-unfold-invoker btn btn-icon btn-ghost-secondary rounded-circle" href="javascript:;"
                data-hs-unfold-options='{
                 "target": "#searchDropdown",
                 "type": "css-animation",
                 "animationIn": "fadeIn",
                 "hasOverlay": "rgba(46, 52, 81, 0.1)",
                 "closeBreakpoint": "md"
               }'>
                <i class="tio-search"></i>
              </a>
            </div>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <div class="hs-unfold">
              <a class="js-hs-unfold-invoker btn btn-icon btn-ghost-secondary rounded-circle" href="javascript:;"
                data-hs-unfold-options="{
                   &quot;target&quot;: &quot;#notificationDropdown&quot;,
                   &quot;type&quot;: &quot;css-animation&quot;
                 }" data-hs-unfold-target="#notificationDropdown" data-hs-unfold-invoker="">
                <i class="tio-notifications-on-outlined"></i>
                <span class="btn-status btn-sm-status btn-status-danger" id="notificationButton"></span>
              </a>

              <div id="notificationDropdown"
                class="hs-unfold-content dropdown-unfold dropdown-menu dropdown-menu-right navbar-dropdown-menu hs-unfold-content-initialized hs-unfold-css-animation animated hs-unfold-hidden"
                style="width: 25rem; animation-duration: 300ms;" data-hs-target-height="518.8" data-hs-unfold-content=""
                data-hs-unfold-content-animation-in="slideInUp" data-hs-unfold-content-animation-out="fadeOut">
                <!-- Header -->
                <div class="card-header">
                  <span class="card-title h4">Notifications</span>

                  <!-- Unfold -->
                </div>
                <!-- End Header -->

                <!-- Nav -->
                <ul class="nav nav-tabs nav-justified" id="notificationTab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="notificationNavOne-tab" data-toggle="tab" href="#notificationNavOne"
                      role="tab" aria-controls="notificationNavOne" aria-selected="true"
                      >Reports </a>
                  </li>
                </ul>
                <!-- End Nav -->

                <!-- Body -->
                <div class="card-body-height">
                  <!-- Tab Content -->
                  <div class="tab-content" id="notificationTabContent">
                    <div class="tab-pane fade show active" id="notificationNavOne" role="tabpanel"
                      aria-labelledby="notificationNavOne-tab">
                      <ul class="list-group list-group-flush navbar-card-list-group" id="reportList">
                        <!-- Dữ liệu sẽ được render ở đây -->
                      </ul>
                    </div>

                  </div>
                </div>

                <a class="card-footer text-center" href="#">

                </a>
                <!-- End Card Footer -->
              </div>
            </div>
          </li>

          <li class="nav-item">
            <div class="hs-unfold">
              <a class="js-hs-unfold-invoker navbar-dropdown-account-wrapper" href="javascript:;"
                data-hs-unfold-options='{
                     "target": "#accountNavbarDropdown",
                     "type": "css-animation"
                   }'>
                <div class="avatar avatar-sm avatar-circle">
                  <img class="avatar-img" src="assets\img\160x160\img6.jpg" id="userAvatar1" alt="Image Description">
                  <span class="avatar-status avatar-sm-status avatar-status-success"></span>
                </div>
              </a>

              <div id="accountNavbarDropdown"
                class="hs-unfold-content dropdown-unfold dropdown-menu dropdown-menu-right navbar-dropdown-menu navbar-dropdown-account"
                style="width: 16rem;">
                <div class="dropdown-item-text">
                  <div class="media align-items-center">
                    <div class="avatar avatar-sm avatar-circle mr-2">
                      <img id="userAvatar" class="avatar-img" src="assets\img\160x160\img6.jpg" alt="Image Description">
                    </div>
                    <div class="media-body">
                      <span id="userName" class="card-title h5">Mark Williams</span>
                      <span id="userEmail" class="card-text">mark@example.com</span>
                    </div>
                  </div>
                </div>

                <div class="dropdown-divider"></div>


                <a class="dropdown-item" th:href="@{/web-server/profile}">
                  <span class="text-truncate pr-2" title="Hồ sơ &amp; tài khoản">Hồ sơ &amp; tài khoản</span>
                </a>

                <a class="dropdown-item" th:href="@{/web-server/edit-profile}">
                  <span class="text-truncate pr-2" title="Settings">Cài đặt</span>
                </a>
                <div class="dropdown-divider"></div>

                <a class="dropdown-item" href="#" id="logoutLink">
                  <span class="text-truncate pr-2" title="Sign out">Đăng xuất</span>
                </a>

              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </header>
</div>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/plugin/relativeTime.js"></script>


<script>

  fetch(`http://localhost:8080/onboarding/users/${localStorage.getItem('user_id')}`, {
    method: "GET",
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('authToken')}`
    }
  })
    .then(res => res.json())
    .then(data => {

      const user = data.data;

      const avatarUrl = user.avatarUrl ? user.avatarUrl : `https://ui-avatars.com/api/?name=${user.fullname}&size=128&background=random`;
      document.getElementById("userAvatar1").src = avatarUrl;
      document.getElementById("userAvatar").src = avatarUrl;
      document.getElementById("userName").textContent = user.fullname || "Tên người dùng";
      document.getElementById("userEmail").textContent = user.email || "email@example.com";
    })
    .catch(error => {
      console.error('Có lỗi khi lấy thông tin người dùng:', error);
    });

  const API_URL = "http://localhost:8080/api/report?size=100&page=0";
  const TOKEN = localStorage.getItem("authToken");

  async function fetchReports() {
    try {
      // Lấy dữ liệu từ API
      const response = await fetch(API_URL, {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${TOKEN}`,
          "Content-Type": "application/json"
        }
      });

      // Kiểm tra lỗi phản hồi
      if (!response.ok) {
        throw new Error(`Lỗi ${response.status}: ${response.statusText}`);
      }

      // Chuyển đổi phản hồi thành JSON
      const result = await response.json();
      console.log(result);

      // Lọc các báo cáo có trạng thái là PENDING
      const reports = Array.isArray(result.content) ? result.content.filter(report => report.status === "PENDING") : [];

      // Lấy phần tử DOM
      const reportList = document.getElementById("reportList");
      const notificationButton = document.getElementById("notificationButton");

      // Nếu không có báo cáo, hiển thị thông báo
      if (reports.length === 0) {
        reportList.innerHTML = `<li class="list-group-item text-center">Không có thông báo nào</li>`;
        if (notificationButton) {
          notificationButton.style.display = "none";
        }
        return;
      }

      if (notificationButton) {
        notificationButton.style.display = "inline";
      }

      reportList.innerHTML = "";
      dayjs.extend(dayjs_plugin_relativeTime);
      dayjs.locale('vi');

      reports.reverse();

      reports.forEach(report => {
        const timeAgo = dayjs(report.create_time);
        const diffInMinutes = timeAgo.diff(dayjs(), 'minute');
        let formattedTime = '';

        if (diffInMinutes < 60) {
          formattedTime = `${Math.abs(diffInMinutes)} m`;
        } else if (diffInMinutes < 1440) {
          const diffInHours = timeAgo.diff(dayjs(), 'hour');
          formattedTime = `${Math.abs(diffInHours)} h`;
        } else if (diffInMinutes < 43200) {
          const diffInDays = timeAgo.diff(dayjs(), 'day');
          formattedTime = `${Math.abs(diffInDays)} d`;
        } else {
          const diffInMonths = timeAgo.diff(dayjs(), 'month');
          formattedTime = `${Math.abs(diffInMonths)} m`;
        }

        const listItem = `
        <li class="list-group-item custom-checkbox-list-wrapper border-0 rounded shadow-sm mb-3">
          <div class="row d-flex align-items-center">
            <!-- Avatar and Checkbox -->
            <div class="col-auto position-static">
              <div class="d-flex align-items-center">
                <div class="avatar avatar-sm avatar-circle">
                  ${report.avatarUrl ?
            `<img class="avatar-img" src="${report.avatarUrl}" alt="Image Description">` :
            `<span class="avatar-img" style="display: flex; align-items: center; justify-content: center; background-color: #ccc; color: white; font-weight: bold; width: 35px; height: 35px; border-radius: 50%;">${(report.fullname.charAt(0).toUpperCase()) || '?'}</span>`}
                </div>
              </div>
            </div>

            <!-- Report Details (Làm cho phần này rộng nhất) -->
            <div class="col flex-grow-1 ml-n3">
              <span class="card-title h5">${report.fullname || "Người dùng ẩn danh"}</span>
              <p class="card-text font-size-sm">
                Đã báo cáo bài viết có ID: ${report.postId} với lý do: ${report.reason || "Không có lý do"}
              </p>
            </div>

            <!-- Time -->
            <div class="text-muted text-cap" style="font-size: 0.8rem;">
              <small>${formattedTime} ago</small>
            </div>
          </div>

          <a class="stretched-link" href="#"></a>
        </li>
      `;

        reportList.insertAdjacentHTML("beforeend", listItem);
      });

    } catch (error) {
      console.error("Lỗi khi gọi API:", error);
      document.getElementById("reportList").innerHTML =
        `<li class="list-group-item text-danger text-center">Không thể tải dữ liệu</li>`;
    }
  }

  fetchReports();






</script>